<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.winter.app.board.qna.QnaDAO">
    	<insert id="add" parameterType="QnaDTO" useGeneratedKeys="true" keyProperty="boardNum">
    		INSERT INTO qna (board_title, board_writer, board_contents, board_date, board_hit, board_ref, board_step, board_depth)
    		VALUES (#{boardTitle}, #{boardWriter}, #{boardContents}, now(), 0, 0, 0, 0)
    	</insert>
    	
    	<update id="refUpdate" parameterType="com.winter.app.board.qna.QnaDTO">
		    UPDATE qna
		    SET board_ref = #{boardNum}
		    WHERE board_num = #{boardNum}
		</update>
		
    	<update id="update" parameterType="java.util.Map">
    		UPDATE notice SET board_title=#{title}, board_writer=#{writer}, board_contents=#{contents}
    		WHERE board_num=#{num}
    	</update>

    	
    	<select id="list" resultType="QnaDTO" parameterType="Pager">
		    SELECT
		        board_num    AS boardNum,
		        board_title  AS boardTitle,
		        board_writer AS boardWriter,
		        board_contents AS boardContents,
		        board_date   AS boardDate,
		        board_hit    AS boardHit,
		        board_ref    AS boardRef,
		        board_step   AS boardStep,
		        board_depth  AS boardDepth
		    FROM qna
		    <where>
		        <if test="kind == 'k1'">
		            board_title LIKE concat('%', #{search}, '%')
		        </if>
		        <if test="kind == 'k2'">
		            board_contents LIKE concat('%', #{search}, '%')
		        </if>
		        <if test="kind == 'k3'">
		            board_num LIKE concat('%', #{search}, '%')
		        </if>
		    </where>
		    ORDER BY board_num DESC
		    LIMIT #{startNum}, #{perPage}
		</select>

    	
   		<select id="detail" resultType="QnaDTO" parameterType="QnaDTO">
		    SELECT
		        board_num    AS boardNum,
		        board_title  AS boardTitle,
		        board_writer AS boardWriter,
		        board_contents AS boardContents,
		        board_date   AS boardDate,
		        board_hit    AS boardHit,
		        board_ref    AS boardRef,
		        board_step   AS boardStep,
		        board_depth  AS boardDepth
		    FROM qna
		    WHERE board_num = #{boardNum}
		</select>
   	
    	<update id="stepUpdate" parameterType="QnaDTO">
    		UPDATE qna SET board_step=board_step+1 
    		WHERE board_ref=#{boardRef} AND board_step > #{boardRef}
    	</update>
    	
    	<select id="count" resultType="Long">
    		SELECT COUNT(board_num) FROM qna
    		<where>
		        <if test="kind == 'k1'">
		            board_title LIKE concat('%', #{search}, '%')
		        </if>
		        <if test="kind == 'k2'">
		            board_contents LIKE concat('%', #{search}, '%')
		        </if>
		        <if test="kind == 'k3'">
		            board_num LIKE concat('%', #{search}, '%')
		        </if>
	    	</where>
    	</select>
    </mapper>